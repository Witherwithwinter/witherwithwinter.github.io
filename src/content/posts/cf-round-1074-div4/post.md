---
title: Codeforces Round 1074 (Div. 4) 
published: 2026-01-20
description: "2026 çš„ç¬¬ä¸€åœº div.4"
image: "./cover.webp"
tags: [Codeforces, Div.4]
category: Tutorial
draft: false
---

# â˜ï¸ä½“éªŒ

å½“å¤©æ—¶é—´è®°é”™äº†ï¼Œæ™šä¸Šåˆšæ‰“å®Œç‰›å®¢å‘¨èµ›ï¼Œç„¶åŽå‘çŽ° div.4 å’Œç‰›å®¢å‘¨èµ›å±…ç„¶æ˜¯åŒä¸€å¤©ï¼Œæœ‰ç‚¹çŒä¸åŠé˜²ã€‚

æ²¡ä»€ä¹ˆçŠ¶æ€ï¼Œä½†æ˜¯æƒ³ä¸Šå¤§åˆ†ï¼Œä¾¿ç¡¬ä¸Šäº†ï¼Œè¡¨çŽ°ä¸ä½³ã€‚

éš¾åº¦æ–¹é¢çš„è¯ï¼Œè¿™åœºçš„é¢˜å¤šæ•°éƒ½æ¯”è¾ƒç®€å•ã€‚

ä¸è¿‡ï¼ŒH æ€Žä¹ˆæ„Ÿè§‰å‡ºæˆ div. 2 çš„ F äº†ï¼Œ2400ï¼Ÿ 

é™©äº›å æœºï¼Œå°ä¸Šåˆ†ã€‚

# ðŸ’¡é¢˜è§£

## A - Perfect Root 

### é¢˜æ„

ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•°æ•° $n$ï¼Œè¾“å‡º $n$ ä¸ªä¸ä¸€æ ·çš„å®Œå…¨å¹³æ–¹æ ¹ã€‚

æ¯”å¦‚ï¼Œ$2 = \sqrt{4}$ï¼Œé‚£ä¹ˆ $2$ å°±æ˜¯å®Œå…¨å¹³æ–¹æ ¹ã€‚

### æ€è·¯

å¾ˆæ˜Žæ˜¾ï¼Œæ‰€æœ‰çš„æ­£æ•´æ•°éƒ½æ˜¯å®Œå…¨å¹³æ–¹æ ¹ã€‚

é‚£ä¹ˆè¾“å‡º $1$ åˆ° $n$ å³å¯ã€‚

> æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘èµ›æ—¶é¢˜ç›®çœ‹é”™äº†ï¼Œä»¥ä¸ºè¦è¾“å‡º $n$ ä¸ªä¸åŒçš„å®Œå…¨å¹³æ–¹æ•°ï¼Œå´æ°å¥½ä¹Ÿæ»¡è¶³é¢˜æ„ã€‚

### æˆ‘çš„èµ›æ—¶ä»£ç 

```cpp
void solve()
{
    int n; 
    cin >> n;

    for(int i = 1; i <= n; i++)
        cout << i * i << " \n"[i == n];
}

```

## B - Prefix Max

### é¢˜æ„

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ­£æ•´æ•°æ•°ç»„ $a$ã€‚

ä½ æœ‰**æœ€å¤š**ä¸€æ¬¡äº¤æ¢ä»»æ„ä¸¤ä¸ªå…ƒç´ ä½ç½®çš„æœºä¼šã€‚

è®¾å‰ç¼€æœ€å¤§å€¼æ•°ç»„ä¸º $pre[i] = max(a[0], \dots, s[i])$

é—®å‰ç¼€æœ€å¤§å€¼æ•°ç»„ä¹‹å’Œæœ€å¤§æ˜¯å¤šå°‘ã€‚

### æ€è·¯

æˆ‘ä»¬è¦è®©æ¯ä¸ªå‰ç¼€æœ€å¤§å€¼å°½å¯èƒ½å¤§ï¼Œå°½å¯èƒ½æŽ¥è¿‘ $a$ çš„æœ€å¤§å€¼ $max(a)$ã€‚

å› ä¸ºï¼Œå‰ç¼€æœ€å¤§å€¼æ˜¯éžå•è°ƒé€’å‡çš„ã€‚

æ‰€ä»¥ä¸éš¾æƒ³åˆ°ï¼Œæˆ‘ä»¬æŠŠ $max(a)$ å’Œ $a[0]$ äº¤æ¢å³å¯ã€‚

å¦å¤–ï¼Œç”±äºŽæ˜¯ "**æœ€å¤š**ä¸€æ¬¡"ï¼Œå¦‚æžœ $max(a)$ åˆšå¥½å°±åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸æ¢ã€‚

å› æ­¤ï¼Œæœ€åŽç­”æ¡ˆå°±æ˜¯ $max(a) \times n$ã€‚

### ä»£ç 

```cpp
void solve()
{
    input(n, a);
    D(*max_element(all(a)) * n);
}
```

## C - Shifted MEX

### é¢˜æ„

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ $a$ã€‚

ä½ å¯ä»¥è¿›è¡Œä¸€æ¬¡æ“ä½œï¼ŒæŠŠ $a$ ä¸­çš„æ‰€æœ‰å…ƒç´ åŠ ä¸Šä¸€ä¸ªæ•° $x$ã€‚

é—® $mex(a)$ çš„æœ€å¤§å€¼æ˜¯å¤šå°‘ã€‚

### æ€è·¯

æˆ‘ä»¬æŠŠè¿™äº›å…ƒç´ éƒ½æ ‡åˆ°ä¸€æ¡æ•°è½´ä¸Šã€‚

ä½ ä¼šå‘çŽ°ï¼Œé¢˜ç›®è¦æ±‚çš„ $mex(a)$ å…¶å®žå°±æ˜¯ä»Ž $0$ å¼€å§‹çš„è¿žç»­ç‚¹æ®µä¸­æ–­å¼€çš„ä½ç½®ã€‚è€Œ $+ x$ è¿™ä¸ªæ“ä½œï¼Œå…¶å®žå°±æ˜¯æŠŠæ‰€æœ‰çš„ç‚¹å·¦å³å¹³ç§»ã€‚ä»»ä½•è¿žç»­çš„ç‚¹æ®µéƒ½å¯ä»¥æ˜¯ä»Ž $0$ å¼€å§‹çš„ã€‚

é‚£ä¹ˆï¼Œé—®é¢˜å°±è½¬åŒ–æˆäº†ï¼Œæ±‚å‡ºæœ€é•¿çš„è¿žç»­ç‚¹æ®µæœ‰å¤šé•¿ã€‚

æˆ‘ä»¬åªéœ€è¦çŸ¥é“æŸä¸ªä½ç½®æœ‰æ²¡æœ‰ç‚¹å°±è¡Œäº†ï¼Œé‡å¤çš„å…ƒç´ æ˜¯ä¸éœ€è¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé›†åˆåŽ»é‡ã€‚

ç„¶åŽï¼Œæ»‘åŠ¨çª—å£éåŽ†é›†åˆç­›é€‰å‡ºæ¥çš„æ•°ç»„ï¼Œç»´æŠ¤é•¿åº¦æœ€å¤§å€¼å³å¯ã€‚

### ä»£ç 

```cpp
void solve()
{
    int n; 
    cin >> n;

    set<int> s;
    for(int i = 0; i < n; i++) 
    {
        int x; 
        cin >> x;
        s.insert(x);
    }

    if(s.size() == 1)
    {
        D(1);
        return;
    }

    vector<int> a(all(s));

    int l = 0, r = 1, m = a.size(), ans = 1;
    for( ; r < m; r++)
        if(a[r - 1] + 1 != a[r]) 
        {
            ans = max(ans, r - l);
            l = r;
        }
    ans = max(ans, r - l);

    D(ans);
}

```

## D - OutOfMemoryError

### é¢˜æ„

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ $a$ å’Œ $m$ ä¸ªæ“ä½œã€‚

æ¯ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªäºŒå…ƒç»„ $(x, y)$ï¼Œè¡¨ç¤ºæŠŠç¬¬ $x$ ä¸ªå…ƒç´ åŠ ä¸Š $y$ã€‚

æ¯æ¬¡æ“ä½œåŽï¼Œå¦‚æžœ $a[x]$ è¶…è¿‡äº† $h$ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°ç»„å°±ä¼šå›žåˆ°æœ€åˆçš„çŠ¶æ€ã€‚

è¦æ±‚æ‰“å°æ•°ç»„æœ€åŽçš„çŠ¶æ€ã€‚

### æ€è·¯

è¿™é¢˜æœ‰å‘ï¼Œçº¯æš´åŠ›æ¨¡æ‹Ÿä¼šè¶…æ—¶ã€‚

è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœæ¯æ¬¡éƒ½ä¼šè¶…è¿‡ $h$ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡éƒ½è¦æŠŠæ¯ä¸ªå…ƒç´ æŒ¨ä¸ªæŒ¨ä¸ªåœ°å¤åŽŸï¼Œè¿™æ ·çš„å¤æ‚åº¦æ˜¯ $O(nm)$ï¼Œæ— æ³•é€šè¿‡è¿™é¢˜ã€‚

æ˜¾ç„¶ï¼Œæ¯æ¬¡éœ€è¦å¤åŽŸçš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªå…ƒç´ éƒ½è¢«æ”¹åŠ¨è¿‡ã€‚å¾ˆå¤šå…ƒç´ ä»Žå¤´åˆ°å°¾éƒ½è¿˜æ˜¯åŽŸæ¥çš„æ ·å­ï¼Œå¤åŽŸæ“ä½œå¯¹å®ƒä»¬è€Œè¨€æ²¡æœ‰æ„ä¹‰ã€‚æ­£æ˜¯è¿™ä¸ªåœ°æ–¹ï¼Œè€—è´¹äº†å¤§é‡çš„æ—¶é—´ï¼Œå¯¼è‡´äº† TLEã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•æ¯æ¬¡æ“ä½œå¯¹å“ªäº›å…ƒç´ æœ‰å½±å“ï¼Œç„¶åŽåªå¯¹è¿™äº›å…ƒç´ è¿›è¡Œå¤åŽŸæ“ä½œå³å¯ã€‚

å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª map è®°å½•æ¯ä¸ªå…ƒç´ çš„å¢žé‡ã€‚

æ¯æ¬¡æ“ä½œæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠç¬¬ $x$ ä¸ªå…ƒç´ çš„å¢žé‡åŠ ä¸Š $y$ å³å¯ã€‚

å¦‚æžœç¬¬ $x$ ä¸ªå…ƒç´ çš„å¢žé‡åŠ ä¸Š $y$ åŽè¶…è¿‡äº† $h$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¸…ç©º mapã€‚

æœ€åŽï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ¯ä¸ªå…ƒç´ çš„å¢žé‡åŠ åˆ°å¯¹åº”çš„å…ƒç´ ä¸Šå³å¯ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±åªéœ€è¦éåŽ†ä¸€æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œçš„å¤æ‚åº¦æ˜¯ $O(\log m)$ï¼Œæœ€åŽæ€»å¤æ‚åº¦æ˜¯ $O(m \log m)$ã€‚

### ä»£ç 

```cpp
void solve()
{
    int n, m, h; 
    cin >> n >> m >> h;

    vector<int> a(n); 
    vcin(a);

    vector<pair<int, int>> b(m);
    for(auto& [x, y] : b) 
        cin >> x >> y;

    map<int, int> d;
        
    for(auto& [x, y] : b) 
    {
        d[x - 1] += y;
        
        if(a[x] + d[x] > h) 
            d.clear();
    }

    for(auto& [x, y] : d)
        a[x] += y;
        
    vD(a);
}

```

## E - The Robotic Rush

### é¢˜æ„

ç»™ä½  $n$ ä¸ªæœºå™¨äººçš„ä½ç½®å’Œ $m$ ä¸ªæ­»äº¡ç‚¹ï¼ŒæŽ¥ä¸‹æ¥å¯¹æ‰€æœ‰çš„æœºå™¨äººåŒæ—¶å‘å‡º $k$ æ¡æŒ‡ä»¤ã€‚

æ¯æ¡æŒ‡ä»¤æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œ'$L$' è¡¨ç¤ºå‘å·¦ç§»åŠ¨ä¸€æ ¼ï¼Œ'$R$' è¡¨ç¤ºå‘å³ç§»åŠ¨ä¸€æ ¼ã€‚

æœºå™¨äººåœ¨ç§»åŠ¨æ—¶ï¼Œå¦‚æžœç§»åŠ¨åˆ°äº†æ­»äº¡ç‚¹ï¼Œé‚£ä¹ˆæœºå™¨äººå°±ä¼šæ­»äº¡ã€‚

é—®æ¯æ¬¡æŒ‡ä»¤åŽï¼Œè¿˜æœ‰å¤šå°‘æœºå™¨äººå­˜æ´»ã€‚

### æ€è·¯

çº¯æ¨¡æ‹Ÿè‚¯å®šè¶…æ—¶ï¼Œæˆ‘ä»¬æ¥è®²è®²å¦‚ä½•ä¼˜åŒ–ã€‚

å…ˆæ¥æµ…æµ…åˆ†æžä¸€ä¸‹ï¼š

- æ¯ä¸ªæœºå™¨äººçš„æ­»äº¡åªä¸Žå·¦å³ä¸¤è¾¹æœ€è¿‘çš„æ­»äº¡ç‚¹æœ‰å…³ï¼›

- æ¯ä¸ªæœºå™¨äººåœ¨åŒä¸€æ—¶åˆ»çš„åç§»é‡æ˜¯ä¸€æ ·çš„ã€‚

é‚£ä¹ˆå°±å¥½åŠžäº†ã€‚

æˆ‘ä»¬ç”¨ $x$ æ¥è¡¨ç¤ºæ‰€æœ‰æœºå™¨äººçš„åç§»é‡ã€‚

å†ç”¨ä¸€ä¸ª $map$ æ¥è®°å½•åç§»é‡ä¸º $x$ æ—¶ï¼Œå“ªäº›ä½ç½®çš„æœºå™¨äººä¼šæ­»äº¡ã€‚

ç„¶åŽé¢„å…ˆç®—å‡ºæ¯ä¸ªæœºå™¨äººçš„å·¦å³ä¸¤è¾¹æœ€è¿‘çš„æ­»äº¡ç‚¹è·ç¦»å®ƒä»¬è‡ªèº«ä½ç½®çš„åç§»é‡ï¼Œç„¶åŽæŒ‰ç…§åç§»é‡æŠŠå®ƒä»¬å­˜åˆ° $map$ é‡Œã€‚

å†ç”¨ä¸€ä¸ª $set$ æ¥è®°å½•å·²ç»æ­»äº¡çš„æœºå™¨äººï¼Œé˜²æ­¢é‡å¤åˆ¤å®šæ­»äº¡ã€‚



æœ€åŽï¼ŒéåŽ†æŒ‡ä»¤ï¼Œæ¯æ¬¡æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹åç§»é‡ä¸º $x$ æ—¶ä¼šæ­»äº¡çš„æœºå™¨äººï¼Œç„¶åŽåˆ¤æ–­æ˜¯å¦æ­»äº¡ï¼Œå¹¶ä»Ž $map$ ç§»é™¤ã€‚éšåŽï¼Œæ›´æ–°ç­”æ¡ˆå¹¶è¾“å‡ºã€‚

### ä»£ç 

```cpp
void solve() 
{
    int n, m, k; 
    cin >> n >> m >> k;

    vector<int> a(n), b(m); 
    vcin(a); 
    vcin(b);

    string s; 
    cin >> s;

    set<int> die;
    map<int, set<int>> dx;

    sort(all(b));
        
    for(int& i  : a) 
    {
        if(b[0] < i)
        {
            int dl = *(lower_bound(all(b), i) - 1) - i;
            dx[dl].insert(i);
        }
        if(i < b[m - 1])
        {
            int dr = *(lower_bound(all(b), i)) - i;
            dx[dr].insert(i);
        }
    }

    int ans = n, x = 0;
    for(char& c : s)
    {
        x += c == 'L' ? -1 : 1;

        vector<int> e;

        for(int i : dx[x])
        {
            e.push_back(i);
            if(die.insert(i).second) 
                ans--;
        }

        for(int& i : e)
            dx[x].erase(i);

        cout << ans << ' ';
    }

    cout << endl;
}

```

## F - BattleCows

### é¢˜æ„

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $2^n$ çš„æ•°ç»„ $a$ï¼Œä»£è¡¨ $2^n$ å¤´ç‰›ï¼Œæ¯å¤´ç‰›çš„æˆ˜æ–—åŠ›ä¸º $a_i$ã€‚

æ¯æ¬¡æˆ˜æ–—ï¼Œå¥‡æ•°ä½ç½®çš„ç‰›ä¼šå’Œå¶æ•°ä½ç½®çš„ç‰›æˆ˜æ–—ï¼Œè¾“çš„ç‰›ä¼šè¢«èµ¢çš„ç‰›è¸©åœ¨è„šä¸‹ã€‚ç„¶åŽï¼Œè¿™å †ç‰›çš„å…±åŒæˆ˜æ–—åŠ›ä¼šå˜æˆè¿™ä¸¤å¤´ç‰›çš„æˆ˜æ–—åŠ›çš„å¼‚æˆ–å’Œã€‚

å¦‚æžœä¸¤å¤´ç‰›çš„æˆ˜æ–—åŠ›ç›¸åŒï¼Œåˆ¤å¥‡æ•°ä½ç½®èµ¢ã€‚

æœ€åŽæ‰€æœ‰çš„ç‰›éƒ½ä¼šå åœ¨ä¸€å †ã€‚

å°±åƒä¸‹é¢è¿™æ ·ï¼š

![alt text](cow1.webp)

![alt text](cow2.webp)

![alt text](cow3.webp)

æŽ¥ä¸‹æ¥ï¼Œä½ ä¼šå¾—åˆ° $q$ ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ $(p, x)$ï¼Œè¡¨ç¤ºæŠŠç¬¬ $p$ å¤´ç‰›çš„æˆ˜æ–—åŠ›æ”¹ä¸º $x$ã€‚

æ¯æ¬¡è¯¢é—®åŽï¼Œä½ éœ€è¦è¾“å‡ºç¬¬ $p$ å¤´ç‰›çš„å¤´ä¸Šæœ‰å¤šå°‘å¤´ç‰›ã€‚

### æ€è·¯

è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯ä¸€ä¸ªçº¿æ®µæ ‘å»ºæ¨¡çš„æ€æƒ³ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠè¿™å †ç‰›çœ‹æˆä¸€ä¸ªçº¿æ®µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€å †ç‰›ã€‚

å…ˆæ­£å¸¸å·¦å³é€’å½’å»ºæ ‘ï¼Œç„¶åŽæŠŠæ¯ä¸ªèŠ‚ç‚¹çš„æˆ˜æ–—åŠ›è®¾ä¸ºå·¦å³å­èŠ‚ç‚¹çš„æˆ˜æ–—åŠ›çš„å¼‚æˆ–å’Œã€‚

ç„¶åŽï¼Œåœ¨å•ç‚¹æ›´æ–°è¿™é‡Œç¨å¾®åŠ ç‚¹ä¸œè¥¿ã€‚

æˆ‘ä»¬åœ¨å¾€ä¸Šé€’å½’çš„æ—¶å€™ï¼Œå…¶å®žå°±æ˜¯åœ¨æ¨¡æ‹Ÿç¬¬ $p$ å¤´ç‰›çš„æˆ˜æ–—è¿‡ç¨‹ã€‚

èµ¢çš„ä¸€è¾¹ä¼šæŠŠè¾“çš„ä¸€è¾¹è¸©åœ¨ä¸‹é¢ã€‚

æˆ‘ä»¬å¤´ä¸Šæœ‰å‡ å¤´ç‰›ï¼Œè¯´ç™½äº†ï¼Œå’Œæˆ‘ä»¬çš„å½“å‰æŽ’åå·®ä¸å¤šã€‚

- å¦‚æžœæˆ‘ä»¬èµ¢äº†ï¼Œæˆ‘ä»¬çš„å½“å‰æŽ’åå°±ä¸å˜ï¼Œ$ans$ å°±ä¸å˜ã€‚

- å¦‚æžœæˆ‘ä»¬è¾“äº†ï¼Œå¦ä¸€è¾¹çš„ç‰›å°±ä¼šå…¨éƒ¨è·‘åˆ°æˆ‘ä»¬å¤´ä¸Šï¼Œ$ans$ å°±ä¼šåŠ ä¸Šå¦ä¸€è¾¹çš„ç‰›çš„æ•°é‡ã€‚

ç‰›çš„æ•°é‡æˆ‘ä»¬å¯ä»¥é€šè¿‡çº¿æ®µæ ‘çš„åŒºé—´é•¿åº¦æ¥è®¡ç®—ã€‚

- å·¦è¾¹çš„ç‰›çš„æ•°é‡å°±æ˜¯ $mid - l + 1$ï¼›
- å³è¾¹çš„ç‰›çš„æ•°é‡å°±æ˜¯ $r - mid$ï¼›

æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œåªéœ€è¦åˆ¤æ–­å·¦å³å­èŠ‚ç‚¹çš„æˆ˜æ–—åŠ›è°å¤§ï¼Œç„¶åŽåŠ ä¸Šå¯¹åº”çš„æ•°é‡è¿”å›ž $ans$ å³å¯ã€‚

æœ€åŽå£°æ˜Žä¸€ä¸‹ï¼Œç”±äºŽ $ans$ åˆå§‹åŒ–æ˜¯ $0$ï¼Œä»£è¡¨çš„æ„ä¹‰æ˜¯å¤´ä¸Šæœ‰å¤šå°‘ç‰›ï¼Œå¹¶ä¸æ˜¯å®žé™…æŽ’åï¼Œä¸Šè¿°çš„æŽ’åçš„å¼•å…¥åªæ˜¯ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æŠŠ $update()$ çš„è¿”å›žå€¼å‡ $1$ã€‚

### ä»£ç 

```cpp
void solve()
{
    int n, q; 
    cin >> n >> q;

    vector<int> a(1 << n), t((1 << n) << 2); 
    vcin(a);

    auto build = [&](this auto&& build, int x, int l, int r) -> void 
    {
        if(l == r) { t[x] = a[l]; return; }
        int mid = (l + r) >> 1;
        build(x << 1, l, mid);
        build(x << 1 | 1, mid + 1, r);
        t[x] = t[x << 1] ^ t[x << 1 | 1];
    };

    auto update = [&](this auto&& update, int x, int l, int r, int pos, int val) -> int
    {
        if(l == r) { t[x] = val; return 0; }
        int mid = (l + r) >> 1, ans = 0;
        bool left = pos <= mid ? true : false;
        if(left) ans += update(x << 1, l, mid, pos, val);
        else ans += update(x << 1 | 1, mid + 1, r, pos, val);
        t[x] = t[x << 1] ^ t[x << 1 | 1];
        if(t[x << 1] >= t[x << 1 | 1]) ans += left ? 0 : (mid - l + 1);
        else ans += left ? (r - mid) : 0;
        return ans;
    };

    build(1, 0, (1 << n) - 1);
        
    while(q--) 
    {
        int p, x; 
        cin >> p >> x;
        D(update(1, 0, (1 << n) - 1, p - 1, x));
        update(1, 0, (1 << n) - 1, p - 1, a[p - 1]);
    }
}
```

## G - Mixing MEXes

### é¢˜æ„

ç»™ä½  $n$ ä¸ªé•¿åº¦ä¸º $l_i$ çš„æ•°ç»„ $a_i$ã€‚

ä½ å¯ä»¥ä»Žæ•°ç»„ $a_i$ ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´  $a_{i,j}$ï¼Œç„¶åŽæŠŠ $a_{i,j}$ ç§»åˆ°å¦ä¸€ä¸ªæ•°ç»„ä¸­ã€‚

æ¯ç§æ–¹æ¡ˆçš„å€¼ $val = \sum_{i=1}^n mex(a_i)$ã€‚

é—®æ‰€æœ‰æ–¹æ¡ˆåŠ èµ·æ¥çš„å€¼ $\sum val$ æ˜¯å¤šå°‘ã€‚

### æ€è·¯

è¿™é¢˜å¯ä»¥å¯ä»¥ä½¿ç”¨è´¡çŒ®æ³•æ¥è§£å†³ã€‚

å¦‚æžœæ‰€æœ‰çš„æ–¹æ¡ˆéƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œæˆ‘ä»¬è®¾ç­”æ¡ˆä¸º $ans$ã€‚

ç„¶åŽå†æ¥çœ‹ï¼Œå¯¹äºŽä»»æ„ä¸€æ¬¡ç§»åŠ¨ï¼Œå¯¹ç­”æ¡ˆäº§ç”Ÿçš„è´¡çŒ®ï¼š

- ä»Ž $a_i$ ä¸­ç§»é™¤ $x$
  
  - å¦‚æžœ $x < mex(a_i)$ å¹¶ä¸” $a_i$ ä¸­åªæœ‰ä¸€ä¸ª $x$ï¼Œé‚£ä¹ˆ $mex(a_i)$ ä¼šå˜æˆ $x$
    
    - è´¡çŒ®ä¸º $x - mex(a_i)$

  - å¦åˆ™ï¼Œå¯¹ $mex(a_i)$ æ²¡æœ‰å½±å“

    - è´¡çŒ®ä¸º $0$

- æŠŠ $x$ åŠ åˆ°å¦ä¸€ä¸ªæ•°ç»„ä¸­

  - å¦‚æžœ $x = mex(a_j)$ï¼Œé‚£ä¹ˆ $mex(a_j)$ ä¼šå˜æˆä¸‹ä¸€ä¸ª $mex(a_j)$ï¼Œæˆ‘ä»¬è®°ä½œ $mex(a_j)^{'}$

    - è´¡çŒ®ä¸º $mex(a_j)^{'} - mex(a_j)$

  - å¦åˆ™ï¼Œå¯¹ $mex(a_j)$ æ²¡æœ‰å½±å“

    - è´¡çŒ®ä¸º $0$

ç»Ÿè®¡æ‰€æœ‰æ•°ç»„çš„å…ƒç´ æ•°é‡ï¼Œè®°ä¸º $cnt = \sum_{i=1}^n l_i$ã€‚

å¾ˆæ˜Žæ˜¾ï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½å¯ä»¥ç§»åˆ°å…¶ä»– $n - 1$ ä¸ªæ•°ç»„ä¸­ã€‚

æ‰€ä»¥æ€»æ–¹æ¡ˆæ•°å°±æ˜¯ $cnt \times (n - 1)$ã€‚

é‚£ä¹ˆç­”æ¡ˆåˆå§‹ä¸º $ans = cnt \times (n - 1) \times \sum_{i=1}^n mex(a_i)$ã€‚

ç§»èµ°äº§ç”Ÿè´¡çŒ®ï¼š

- æ¯æ¬¡è´¡çŒ®å€¼ä¸º $x - mex(a_i)$

- å¯ä»¥ç§»åˆ°å…¶ä»– $n - 1$ ä¸ªæ•°ç»„ä¸­

æ‰€ä»¥æ˜¯ $(x - mex(a_i)) \times (n - 1)$ã€‚

ç§»å…¥äº§ç”Ÿè´¡çŒ®ï¼š

- æ¯æ¬¡è´¡çŒ®å€¼ä¸º $mex(a_j)^{'} - mex(a_j)$

- ä¸€å…±æœ‰ $f(mex(a_j))$ ä¸ª $mex(a_j)$ã€‚æ˜¾ç„¶ï¼Œå…¨åœºæ‰€æœ‰çš„ $mex(a_j)$ éƒ½å±žäºŽå…¶ä»–æ•°ç»„ã€‚

æ‰€ä»¥æ˜¯ $f(mex(a_j)) \times (mex(a_j)^{'} - mex(a_j))$ã€‚

æŠŠè¿™äº›è´¡çŒ®åŠ åˆ° $ans$ é‡Œé¢å°±æ˜¯æœ€ç»ˆç­”æ¡ˆäº†ã€‚

### ä»£ç 

```cpp
void solve()
{
    int n; 
    cin >> n;

    vector<map<int, int>> a(n);
    int cnt = 0;
    map<int, int> f;
    for(auto& mp : a)
    {
        int l; 
        cin >> l;
        cnt += l;
        while(l--)
        {
            int x; 
            cin >> x;
            mp[x]++;
            f[x]++;
        }
    }

    vector<array<int, 2>> mex(n);
    for(int i = 0; i < n; i++)
    {
        for(auto& [k, v] : a[i])
        {
            if(k > mex[i][0]) break;
            if(k == mex[i][0]) mex[i][0]++;
        }
        mex[i][1] = mex[i][0] + 1;
        for(auto& [k, v] : a[i])
        {
            if(k > mex[i][1]) break;
            if(k == mex[i][1]) mex[i][1]++;
        }
    }

    int sum = 0;
    for(int i = 0; i < n; i++)
        sum += mex[i][0];
        
    int ans = cnt * (n - 1) * sum;
        
    for(int i = 0; i < n; i++)
        for(auto& [k, v] : a[i])
            if(v == 1 && k < mex[i][0]) 
                ans += (k - mex[i][0]) * (n - 1);
        
    for(int i = 0; i < n; i++)
        ans += f[mex[i][0]] * (mex[i][1] - mex[i][0]);

    D(ans);
}
```

## H - BattleCows 2

å¾…æ›´æ–°

# ðŸŽˆæ¨¡æ¿

## ç«è½¦å¤´

```cpp
#include <bits/stdc++.h>
#define inf INT_MAX
#define INF LLONG_MAX
#define MOD 1000000007
#define mod 998244353
#define all(_x) _x.begin(), _x.end()
#define vcin(_x) for(auto& _i : _x) cin >> _i
#define vvcin(_x) for(auto& _j : _x) for(auto& _i : _j) cin >> _i
#define D(_x) cout << _x << endl
#define vD(_x) for(int _i = 0; _i < _x.size(); ++_i) cout << _x[_i] << " \n"[_i == _x.size() - 1]
#define input(_n, _a) int _n; cin >> _n; vector<int> _a(_n); vcin(_a)
#define flr(_i, _l, _r) for(int _i = _l; _i <= _r; ++_i)
#define frl(_i, _r, _l) for(int _i = _r; _i >= _l; --_i)
#define YES cout << "YES" << endl
#define NO cout << "NO" << endl
#define Yes cout << "Yes" << endl
#define No cout << "No" << endl
#define yes cout << "yes" << endl
#define no cout << "no" << endl
using namespace std;

#define int long long
#define endl '\n' 

void solve()
{
    
}

signed main()
{
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int _ = 1;
cin >> _;
    while (_--)
        solve();
    return 0;
}
```
